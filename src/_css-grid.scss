// =============================================================================
// CSS Grid System — 12-column responsive grid
//
// Usage:
//   <div class="sh-grid sh-gap-4">
//     <div class="sh-col-6 sh-col-12-xs">…</div>
//     <div class="sh-col-6 sh-col-12-xs">…</div>
//   </div>
//
//   <div class="sh-grid-auto-md sh-gap-4">auto-fit cards</div>
//
// Breakpoint suffixes match $breakpoints keys: -xs, -sm, -md, -lg, -xl
// =============================================================================
@use "sass:map";
@use "variables" as vars;

// ---------------------------------------------------------------------------
// Base grid
// ---------------------------------------------------------------------------
.#{vars.$prefix}grid,
[class*="#{vars.$prefix}grid-auto-"] {
  display: grid;
  gap: var(--grid-gap, 0);
}

.#{vars.$prefix}grid {
  --grid-cols: #{vars.$grid-columns};
  grid-template-columns: repeat(var(--grid-cols), 1fr);

  > * {
    grid-column: span var(--span, #{vars.$grid-columns}) / span
      var(--span, #{vars.$grid-columns});
  }
}

// ---------------------------------------------------------------------------
// Auto-fit grid sizes
// ---------------------------------------------------------------------------
$_auto-sizes: (xs: 8rem, sm: 10rem, md: 15rem, lg: 20rem, xl: 25rem);

%_auto-grid-tpl {
  grid-template-columns: repeat(auto-fit, minmax(var(--col-min-width), 1fr));
}

@each $name, $width in $_auto-sizes {
  .#{vars.$prefix}grid-auto-#{$name} {
    @extend %_auto-grid-tpl;
    --col-min-width: #{$width};
  }
}

.#{vars.$prefix}grid-auto-cols {
  grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
}

// ---------------------------------------------------------------------------
// Gap utilities (0.25rem steps, matches Tailwind spacing scale)
// ---------------------------------------------------------------------------
$_gap-scale: (
  0: 0, 1: 0.25rem, 2: 0.5rem, 3: 0.75rem, 4: 1rem,
  5: 1.25rem, 6: 1.5rem, 7: 1.75rem, 8: 2rem,
  10: 2.5rem, 12: 3rem, 14: 3.5rem, 16: 4rem,
);

@each $key, $value in $_gap-scale {
  .#{vars.$prefix}gap-#{$key}   { gap: $value; --grid-gap: #{$value}; }
  .#{vars.$prefix}gap-x-#{$key} { column-gap: $value; }
  .#{vars.$prefix}gap-y-#{$key} { row-gap: $value; }
}

// ---------------------------------------------------------------------------
// Column span, start, end — base (no breakpoint)
// ---------------------------------------------------------------------------
@for $i from 1 through vars.$grid-columns {
  .#{vars.$prefix}col-#{$i}         { --span: #{$i}; }
  .#{vars.$prefix}col-start-#{$i}   { grid-column-start: #{$i}; }
  .#{vars.$prefix}col-end-#{$i + 1} { grid-column-end: #{$i + 1}; }
}

.#{vars.$prefix}col-start      { grid-column-start: 1; }
.#{vars.$prefix}col-end        { grid-column-end: -1; }
.#{vars.$prefix}col-start-auto { grid-column-start: auto; }
.#{vars.$prefix}col-end-auto   { grid-column-end: auto; }

// ---------------------------------------------------------------------------
// Responsive variants — generated from $breakpoints map
// Suffix matches breakpoint key: -xs, -sm, -md, -lg, -xl
// ---------------------------------------------------------------------------
@mixin _responsive-grid($sfx) {
  @each $name, $width in $_auto-sizes {
    .#{vars.$prefix}grid-auto-#{$name}-#{$sfx} { --col-min-width: #{$width}; }
  }

  .#{vars.$prefix}grid-auto-cols-#{$sfx} {
    grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
  }

  @for $i from 1 through vars.$grid-columns {
    .#{vars.$prefix}col-#{$i}-#{$sfx}         { --span: #{$i}; }
    .#{vars.$prefix}col-start-#{$i}-#{$sfx}   { grid-column-start: #{$i}; }
    .#{vars.$prefix}col-end-#{$i + 1}-#{$sfx} { grid-column-end: #{$i + 1}; }
  }

  .#{vars.$prefix}col-start-#{$sfx}      { grid-column-start: 1; }
  .#{vars.$prefix}col-end-#{$sfx}        { grid-column-end: -1; }
  .#{vars.$prefix}col-start-auto-#{$sfx} { grid-column-start: auto; }
  .#{vars.$prefix}col-end-auto-#{$sfx}   { grid-column-end: auto; }
}

@each $bp, $size in vars.$breakpoints {
  @media (min-width: #{$size}) {
    @include _responsive-grid($bp);
  }
}
